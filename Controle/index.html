<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contr√¥le Documentaire - Cabinet de Gestion de Patrimoine</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Contr√¥le Documentaire</h1>
            <p>Cabinet de Gestion de Patrimoine - Interface de gestion compl√®te</p>
        </div>

        <!-- Debug Panel -->
        <div class="debug-panel" id="debug-panel">
            <div class="debug-title">üîç Informations de d√©bogage</div>
            <div id="debug-content"></div>
        </div>

        <!-- Section 1: File Upload -->
        <div class="content-section active" id="file-upload-section">
            <h2 class="section-title">√âtape 1 : Ouverture du fichier Excel</h2>
            
            <div class="file-upload-area" onclick="document.getElementById('file-input').click()">
                <div class="upload-icon">üìÅ</div>
                <div class="upload-text">Cliquez pour s√©lectionner le fichier Excel</div>
                <div class="upload-subtext">ou glissez-d√©posez le fichier ici<br>Formats accept√©s: .xlsx, .xls, .xlsm</div>
            </div>
            
            <input type="file" id="file-input" class="file-input" accept=".xlsx,.xls,.xlsm">
            
            <div class="file-info" id="file-info">
                <div class="file-name" id="file-name"></div>
                <div class="file-stats">
                    <div class="file-stat">
                        <div class="stat-number" id="total-rows">0</div>
                        <div class="stat-label">Dossiers trouv√©s</div>
                    </div>
                    <div class="file-stat">
                        <div class="stat-number" id="total-columns">0</div>
                        <div class="stat-label">Colonnes</div>
                    </div>
                    <div class="file-stat">
                        <div class="stat-number" id="file-size">0 KB</div>
                        <div class="stat-label">Taille du fichier</div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-success" onclick="proceedToSelection()">
                        Continuer vers la s√©lection
                    </button>
                    <button class="btn btn-warning" onclick="showAutomaticControls()">
                        Contr√¥les automatiques
                    </button>
                    <button class="btn btn-secondary" onclick="resetFile()">
                        Changer de fichier
                    </button>
                </div>
            </div>
        </div>

        <!-- Section 2: Dossier Selection -->
        <div class="content-section" id="dossier-selection-section">
            <h2 class="section-title">√âtape 2 : S√©lection des dossiers √† contr√¥ler</h2>
            
            <!-- Filters -->
            <div class="filters-section">
                <h3 style="margin-bottom: 15px; color: #1a1a2e;">Filtres</h3>
                <div class="filters-grid">
                    <div class="filter-group">
                        <label class="filter-label">Conseiller</label>
                        <select class="filter-select" id="filter-conseiller">
                            <option value="">Tous les conseillers</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Domaine</label>
                        <select class="filter-select" id="filter-domaine">
                            <option value="">Tous les domaines</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Type d'Acte</label>
                        <select class="filter-select" id="filter-type-acte">
                            <option value="">Tous les types</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Nouveau Client</label>
                        <select class="filter-select" id="filter-nouveau">
                            <option value="">Tous</option>
                            <option value="Oui">Nouveaux clients uniquement</option>
                            <option value="Non">Clients existants uniquement</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Mois d'envoi</label>
                        <select class="filter-select" id="filter-date-envoi">
                            <option value="">Tous les mois</option>
                        </select>
                    </div>
                    <div class="filter-group" id="custom-date-group" style="display: none;">
                        <label class="filter-label">P√©riode personnalis√©e</label>
                        <div class="date-range-inputs">
                            <input type="date" class="filter-input" id="filter-date-from" placeholder="Du">
                            <input type="date" class="filter-input" id="filter-date-to" placeholder="Au">
                        </div>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Recherche</label>
                        <input type="text" class="filter-input" id="filter-search" placeholder="Nom, pr√©nom, r√©f√©rence...">
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="applyFilters()">Appliquer les filtres</button>
                    <button class="btn btn-secondary" onclick="clearFilters()">Effacer</button>
                    <button class="btn btn-warning" onclick="showFileUpload()">Changer de fichier</button>
                    <button class="btn btn-info" onclick="showAutomaticControls()">Contr√¥les automatiques</button>
                </div>
            </div>

            <!-- Selection Summary -->
            <div class="selection-summary" id="selection-summary">
                <div class="selection-count">
                    <span id="selected-count">0</span> dossier(s) s√©lectionn√©(s)
                </div>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="proceedToControl()">
                        D√©marrer le contr√¥le
                    </button>
                    <button class="btn btn-secondary" onclick="clearSelection()">
                        D√©s√©lectionner tout
                    </button>
                </div>
            </div>

            <!-- Table -->
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>
                                <div class="checkbox-container">
                                    <div class="checkbox" id="select-all-checkbox" onclick="toggleSelectAll()"></div>
                                </div>
                            </th>
                            <th>Client</th>
                            <th>Code Dossier</th>
                            <th>Assistant BO</th>
                            <th>Conseiller</th>
                            <th>Domaine</th>
                            <th>Contrat</th>
                            <th>Type Acte</th>
                            <th>Montant</th>
                            <th>√âtat BO</th>
                            <th>Nouveau</th>
                            <th>PPE</th>
                        </tr>
                    </thead>
                    <tbody id="dossiers-table-body">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Section 3: Automatic Controls -->
        <div class="content-section" id="automatic-control-section">
            <h2 class="section-title">√âtape 3 : Contr√¥les automatiques</h2>
            
            <div class="automatic-controls-intro">
                <p>S√©lectionnez le type de contr√¥le √† effectuer. Le syst√®me choisira automatiquement un √©chantillon de dossiers selon les crit√®res d√©finis pour chaque type de contr√¥le.</p>
            </div>

            <div class="control-types-grid">
                <!-- Les cartes de contr√¥le seront g√©n√©r√©es dynamiquement par JavaScript -->
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="showFileUpload()">
                    Changer de fichier
                </button>
                <button class="btn btn-info" onclick="showDossierSelection()">
                    S√©lection manuelle
                </button>
                <button class="btn btn-info" onclick="showHistory()">
                    üìã Voir l'historique
                </button>
            </div>
        </div>

        <!-- Section 3bis: Sample Selection -->
        <div class="content-section" id="sample-selection-section">
            <h2 class="section-title">√âtape 3bis : S√©lection dans l'√©chantillon</h2>
            
            <div class="sample-info">
                <p>Choisissez le dossier √† contr√¥ler dans l'√©chantillon g√©n√©r√© automatiquement :</p>
            </div>

            <div class="sample-table-container">
                <table class="sample-table">
                    <thead>
                        <tr>
                            <th>Client</th>
                            <th>Code Dossier</th>
                            <th>Conseiller</th>
                            <th>Montant</th>
                            <th>Domaine</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="sample-table-body">
                        <!-- Les dossiers de l'√©chantillon seront g√©n√©r√©s dynamiquement -->
                    </tbody>
                </table>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="showAutomaticControls()">
                    Retour aux contr√¥les
                </button>
                <button class="btn btn-info" onclick="showDossierSelection()">
                    S√©lection manuelle
                </button>
            </div>
        </div>

        <!-- Section 3ter: Choix du type de contr√¥le manuel -->
        <div class="content-section" id="manual-control-type-section">
            <h2 class="section-title">√âtape 3 : Type de contr√¥le pour la s√©lection manuelle</h2>
            
            <div class="manual-control-info">
                <div class="info-card">
                    <h3>üìã R√©capitulatif de votre s√©lection</h3>
                    <p>Vous avez s√©lectionn√© <strong><span id="manual-selected-count">0</span></strong> dossier(s) pour un contr√¥le manuel.</p>
                    <p>Choisissez maintenant le type de contr√¥le √† effectuer sur ces dossiers :</p>
                </div>
            </div>

            <!-- Aper√ßu des dossiers s√©lectionn√©s -->
            <div class="selected-dossiers-preview">
                <h3>üéØ Dossiers qui seront contr√¥l√©s :</h3>
                <div class="dossiers-preview-grid" id="selected-dossiers-list">
                    <!-- Liste g√©n√©r√©e dynamiquement -->
                </div>
            </div>

            <!-- Types de contr√¥le disponibles pour le manuel -->
            <div class="manual-control-types">
                <h3>üîç Choisissez le type de contr√¥le :</h3>
                <div class="control-types-grid" id="manual-control-types-grid">
                    <!-- Cartes de types de contr√¥le g√©n√©r√©es dynamiquement -->
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="showDossierSelection()">
                    ‚Üê Retour √† la s√©lection
                </button>
                <button class="btn btn-info" onclick="showAutomaticControls()">
                    ü§ñ Contr√¥les automatiques
                </button>
            </div>
        </div>

        <!-- Section 3ter: Document Control -->
        <div class="content-section" id="document-control-section">
            <h2 class="section-title">Contr√¥le Documentaire</h2>
            
            <!-- Informations du dossier -->
            <div id="dossier-info">
                <!-- Les informations du dossier seront g√©n√©r√©es dynamiquement -->
            </div>

            <!-- Grille des documents -->
            <div class="documents-section">
                <h3>Documents √† contr√¥ler</h3>
                <div id="documents-grid" class="documents-grid">
                    <!-- Les cartes de documents seront g√©n√©r√©es dynamiquement -->
                </div>
            </div>

            <!-- Boutons de contr√¥le -->
            <div id="control-buttons">
                <!-- Les boutons seront g√©n√©r√©s dynamiquement -->
            </div>
        </div>

        <!-- Section 3quater: Question Interface -->
        <div class="content-section" id="question-interface-section">
            <h2 class="section-title">Questions du document</h2>
            
            <div id="question-container">
                <!-- L'interface de questions sera g√©n√©r√©e dynamiquement -->
            </div>
        </div>

        <!-- Section 3quint: Progression du contr√¥le manuel -->
        <div class="content-section" id="manual-control-progress-section">
            <h2 class="section-title">Contr√¥le Manuel en Cours</h2>
            
            <!-- Barre de progression -->
            <div class="manual-progress-container">
                <div class="manual-progress-header">
                    <h3>üìä Progression du contr√¥le</h3>
                    <div class="progress-info">
                        Dossier <span id="current-dossier-number">1</span> sur <span id="total-dossiers-count">1</span>
                        <span class="progress-percentage">(<span id="progress-percent">0</span>%)</span>
                    </div>
                </div>
                
                <div class="progress-bar-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="manual-progress-fill" style="width: 0%"></div>
                    </div>
                </div>
                
                <div class="current-dossier-info">
                    <div class="current-dossier-card">
                        <h4>üìÅ Dossier actuel :</h4>
                        <div class="current-dossier-details">
                            <div class="detail"><strong>Client :</strong> <span id="current-dossier-client">-</span></div>
                            <div class="detail"><strong>Code :</strong> <span id="current-dossier-code">-</span></div>
                            <div class="detail"><strong>Conseiller :</strong> <span id="current-dossier-conseiller">-</span></div>
                            <div class="detail"><strong>Montant :</strong> <span id="current-dossier-montant">-</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Boutons de navigation -->
            <div class="manual-progress-actions">
                <div class="btn-group">
                    <button class="btn btn-warning" onclick="window.documentController?.pauseManualControl()" id="pause-btn">
                        ‚è∏Ô∏è Mettre en pause
                    </button>
                    <button class="btn btn-danger" onclick="window.documentController?.cancelManualControl()" id="cancel-btn">
                        ‚ùå Annuler tout
                    </button>
                </div>
            </div>
            
            <!-- R√©sultats des dossiers pr√©c√©dents -->
            <div class="completed-dossiers" id="completed-dossiers-section" style="display: none;">
                <h3>‚úÖ Dossiers d√©j√† contr√¥l√©s :</h3>
                <div class="completed-list" id="completed-dossiers-list">
                    <!-- Liste g√©n√©r√©e dynamiquement -->
                </div>
            </div>
        </div>

        <!-- Section 4: Control Interface -->
        <div class="content-section" id="control-section">
            <h2 class="section-title">√âtape 4 : Interface de contr√¥le</h2>
            
            <div class="control-content">
                <p>Interface de contr√¥le en cours de d√©veloppement...</p>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="showDossierSelection()">
                    Retour √† la s√©lection
                </button>
                <button class="btn btn-info" onclick="showAutomaticControls()">
                    Contr√¥les automatiques
                </button>
                <button class="btn btn-success" onclick="downloadResults()">
                    T√©l√©charger les r√©sultats
                </button>
            </div>
        </div>
    </div>

    <!-- Section finale: R√©sum√© des contr√¥les manuels -->
    <div class="content-section" id="manual-control-summary-section">
        <h2 class="section-title">üéâ R√©sum√© des Contr√¥les Manuels</h2>
        
        <!-- Statistiques globales -->
        <div class="manual-summary-stats">
            <div class="summary-cards">
                <div class="summary-card">
                    <div class="card-icon">üìä</div>
                    <div class="card-value" id="summary-total-dossiers">0</div>
                    <div class="card-label">Dossiers contr√¥l√©s</div>
                </div>
                <div class="summary-card success">
                    <div class="card-icon">‚úÖ</div>
                    <div class="card-value" id="summary-conformes">0</div>
                    <div class="card-label">Conformes</div>
                </div>
                <div class="summary-card danger">
                    <div class="card-icon">‚ùå</div>
                    <div class="card-value" id="summary-non-conformes">0</div>
                    <div class="card-label">Non conformes</div>
                </div>
                <div class="summary-card info">
                    <div class="card-icon">üìà</div>
                    <div class="card-value" id="summary-taux-conformite">0%</div>
                    <div class="card-label">Taux conformit√©</div>
                </div>
                <div class="summary-card warning">
                    <div class="card-icon">‚ö†Ô∏è</div>
                    <div class="card-value" id="summary-total-anomalies">0</div>
                    <div class="card-label">Anomalies majeures</div>
                </div>
            </div>
        </div>

        <!-- Informations d√©taill√©es -->
        <div class="manual-control-details">
            <div class="control-info-summary">
                <h3>üìã Informations du contr√¥le</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Type de contr√¥le :</span>
                        <span class="info-value" id="summary-control-type">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Dur√©e totale :</span>
                        <span class="info-value" id="summary-duration">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">D√©marr√© le :</span>
                        <span class="info-value" id="summary-start-time">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Termin√© le :</span>
                        <span class="info-value" id="summary-end-time">-</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tableau d√©taill√© des r√©sultats -->
        <div class="manual-results-table-container">
            <h3>üìÑ D√©tail par dossier</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>üë§ Client</th>
                            <th>üî¢ Code Dossier</th>
                            <th>üë®‚Äçüíº Conseiller</th>
                            <th>üí∞ Montant</th>
                            <th>üìÑ Documents</th>
                            <th>‚ö†Ô∏è Anomalies</th>
                            <th>‚úÖ Conformit√©</th>
                            <th>üîß Actions</th>
                        </tr>
                    </thead>
                    <tbody id="manual-results-tbody">
                        <!-- R√©sultats g√©n√©r√©s dynamiquement -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Actions finales -->
        <div class="manual-summary-actions">
            <div class="btn-group">
                <button class="btn btn-success" onclick="window.documentController?.exportAllManualResults()">
                    üìä Exporter tous les r√©sultats Excel
                </button>
                <button class="btn btn-info" onclick="window.historyInterface?.show()">
                    üìã Voir l'historique complet
                </button>
                <button class="btn btn-primary" onclick="showDossierSelection()">
                    üîÑ Nouveau contr√¥le manuel
                </button>
                <button class="btn btn-secondary" onclick="showAutomaticControls()">
                    ‚Üê Retour aux contr√¥les automatiques
                </button>
            </div>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
</body>
</html>






